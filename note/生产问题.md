
### 2022年
#### 2022.4.14 生产上金额展示有误
* 现象：金额展示有误。
* 原因说明：金额展示时需要使用到千分位，例如 2,000。而客户使用的手机为法语系统，在法语中千分位为 ，因此法语中两千展示未 2 000。
  而后续的成处理中直接通过替换掉‘,’ 来得到一个数值来计算。
  问题的根源：法语中千分位与中文中不一致，而程序固定按照中文的来处理了。
  js中是通过 .toLocaleString(); 来展示千分位的。
    ```javascript
    var rone = 20000;
    rone.toLocaleString();//'20,000'
    rone.toLocaleString('fr');//'20 000'
    rone.toLocaleString('en');//'20,000'
    rone.toLocaleString('zh');//'20,000'
    ```
* 解决方案：项目仅在国内运营且暂无国际化的计划故此时问题建议客户切换系统语言后在使用服务。


#### 2022.4.12 生产服务器无法提供服务
* 现象：无法提供服务
* 原因说明：业务在未通知的情况下组织了一次抢购活动，其中有个与第三方系统交互的功能很慢，导致四台服务器请求线程资源耗尽无法提供服务。
  项目使用springboot内嵌的jetty作为服务器，未手动指定最大连接数、最大请求并发数，皆使用默认的配置。
  最大并发200，最大连接数为Integer.MAX_VALUE(未验证)，理论上咱服务最大并发为200*4=800。
  在无抢购活动的情况下800的并发在上线两年时间内从未出现过服务阻塞的情况，日常的流量并不大。
* 解决方案：第三方系统优化业务功能提升处理效率。


#### 2022.4.11 客户提示出现异常说明
* 现象：提示出现异常说明。
* 原因说明：拦截器中对于需要登录权限的请求做了判断，没权限的在response中设置错误码后直接返回不会进入到下一步执行。
  而因为需求迭代疏忽导致设置完错误码后没有直接返回，流程继续往下执行了，后续的处理中又一次往response中写入返回的报文，导致报错。
  异常类型：`org.springframework.web.util.NestedServletException: Request processing failed; nested exception is java.lang.IllegalStateException: WRITER`
* 解决方案：bug修复。


************************************************************************************************************************
### 之前
#### Timer定时器线程未手动释放，倒是生产环境上线程过多耗尽服务器资源导致系统崩溃。
* 现象：栈溢出。
* 原因说明：Timer定时器线程未手动释放，倒是生产环境上线程过多耗尽服务器资源导致系统崩溃。
* 解决方案：在定时器任务执行后，立即手动关闭线程。


#### sql语句中有使用到in时需要考虑到in之后的参数数量，oracle 11中限制为1000个。
* 现象：sql语句报错。
* 原因说明：oracle数据库中，sql语句使用in时参数数量超过了oracle的限制 1000 。
* 解决方案：将sql语句拆分成多个子语句查询。


#### org.springframework.web.multipart.MultipartException: Could not parse multipart servlet request;
* 现象：nested exception is java.io.IOException：The temporary upload location /tmp/tomcat.276123452235494.8080/work/Tomcat/localhost/ROOT is not valid
* 原因说明：在Linux系统中，springboot应用服务在启动（java -jar 命令启动服务）的时候，默认会在操作系统的/tmp目录下生成一个tomcat*的文件目录，上传/下载的文件先要转换成临时文件保存在这个文件夹下面。
  由于临时/tmp目录下的文件，在长时间没有使用的情况下，就会被Linux系统机制自动删除掉，导致下载文件时系统找不到文件路径导致IO异常。所以如果系统长时间无人问津的话，就可能导致上面这个问题。
* 解决方案：在启动的脚本中手动去配置一个不会被系统回收的文件路径 -Djava.io.tmpdir=/home/rone